import{a as d}from"./chunk-PQ4Z2ZC5.js";import{I as m,L as g,P as c,U as l,e as a,i as x,p,q as u}from"./chunk-ORCX4ZWA.js";var I=["fashion","groceries","cryptocurrency"],f=[...I];var E=class i{STORAGE_KEY="expenses";_expenseList$;_localStorageService=l(d);constructor(){let e=this._localStorageService.getItem(this.STORAGE_KEY)||[];this._expenseList$=new x(e)}addItem(e){let s=[...this._expenseList$.getValue(),e];this._expenseList$.next(s),this.saveToLocalStorage(s)}get expenseList$(){return this._expenseList$}updateItem(e){let s=this._expenseList$.getValue().map(n=>n.id===e.id?e:n);this._expenseList$.next(s),this.saveToLocalStorage(s)}deleteItem(e){let s=this._expenseList$.getValue().filter(n=>n.id!==e);this._expenseList$.next(s),this.saveToLocalStorage(s)}getById(e){return e?this._expenseList$.getValue().find(t=>t.id===e):void 0}get categories(){return f}getExpenses$(e,t,s,n){let r=u([t,e]).pipe(p(([o,v])=>n(o,v)));return u([s,r]).pipe(this.list_map())}getExpensesKey$(e,t){return t.pipe(g(e),this.list_map(),p(s=>{let n=Object.keys(s);return t.value?n.sort((r,o)=>+o-+r):n.sort((r,o)=>new Date(r).getTime()-new Date(o).getTime())}))}getExpensesTotalImport$(e,t){return t.pipe(g(e),p(([s,n])=>s.reduce((r,o)=>{let v=n[o]??[];return r[o]=v.reduce((b,$)=>b+$.amount,0),r},{})))}list_map(){return p(([e,t])=>{let s={};for(let n of t){let r=this.getGroupKey(n,e);s[r]||(s[r]=[]),s[r].push(n)}return s})}getGroupKey(e,t){return t?e.date.getFullYear().toString():e.date.toLocaleString("default",{month:"long"})}saveToLocalStorage(e){this._localStorageService.setItem(this.STORAGE_KEY,e)}ngOnDestroy(){this._expenseList$.complete()}static \u0275fac=function(t){return new(t||i)};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};var S=class i{expensesFiltered$=new a;expensesFilteredKey$=new a;expenseService=l(E);expenseItems$=this.expenseService.expenseList$;expensesTotal$=new a;filterFn=(e,t)=>e==="all"?t:t.filter(s=>s.category===e);initialize(e,t){this.expensesFiltered$=this.expenseService.getExpenses$(this.expenseItems$,e,t,this.filterFn),this.expensesFilteredKey$=this.expensesFiltered$.pipe(p(s=>Object.values(s).flat()),m(s=>this.expenseService.getExpensesKey$(new x(s),t))),this.expensesTotal$=this.expenseService.getExpensesTotalImport$(this.expensesFiltered$,this.expensesFilteredKey$)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};var y=class i{expenseService=l(E);filteredExpenses$=new a;expensesFilteredKey$=new a;expenseItems$=this.expenseService.expenseList$;filterFn=(e,t)=>{if(e.length===0)return t;let s=t.filter(n=>n.description.toLowerCase().replace(/\s/g,"").includes(e));return s.length===0?t:s};initialize(e,t){this.filteredExpenses$=this.expenseService.getExpenses$(this.expenseItems$,e,t,this.filterFn),this.expensesFilteredKey$=this.filteredExpenses$.pipe(p(s=>Object.values(s).flat()),m(s=>this.expenseService.getExpensesKey$(new x(s),t)))}deleteExpense(e){this.expenseService.deleteItem(e)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};export{E as a,y as b,S as c};
